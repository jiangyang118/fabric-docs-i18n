

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>&lt;no title&gt; &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="wallet.html" />
    <link rel="prev" title="&lt;no title&gt;" href="connectionprofile.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">Hyperledger Fabric v2.0 更新说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#id7">发行说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">关键概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing_applications.html">开发应用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_guide_overview.html">部署一个生产网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">操作指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">升级到最新版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">命令参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">架构参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">欢迎贡献！</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">版本发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">仍有问题？</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">状态</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="developing_applications.html">开发应用</a> &raquo;</li>
        
          <li><a href="designelements.html">应用程序设计元素</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/developapps/connectionoptions.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># 连接选项</p>
<p><strong>受众</strong>：架构师、管理员、应用程序与智能合约开发者</p>
<p>连接选项（Connection option）用于与连接配置文件联合使用去*精准地*控制一个网关如何与网络交互。通过使用网关，允许一个应用开发专注于商业逻辑而不是网络拓扑。</p>
<p>本主题中，我们将涉及:</p>
<ul class="simple">
<li><p>[为什么连接选项很重要](#情景)</p></li>
<li><p>[应用程序如何使用连接选项](#用法)</p></li>
<li><p>[每个连接选项的作用](#选项)</p></li>
<li><p>[何时使用特定的连接选项](#注意事项)</p></li>
</ul>
<p>## 情景</p>
<p>连接选项指定网关行为的特定方面。网关对于[一些原因](./gateway.html)是重要，其主要目的是允许应用程序去聚焦在业务逻辑和智能合约，同时管理与网络的一些组件的交互。</p>
<p>![profile.scenario](./develop.diagram.35.png)
<em>连接控制行为的不同交互点。这些选项将会在本文中被充分说明</em></p>
<p>一个连接选项的例子可能是想说明：被 <cite>issue</cite> 程序使用的网关应该使用 <cite>Isabella</cite> 身份将交易提交到 <cite>papernet</cite> 网络中。另一个可能是网关应该等待来自 MagnetoCorp 的三个节点去确定一个交易被提交并返回控制。连接选项允许应用程序去指定与网络交互的网关的精准行为。如果没有网关，应用程序需要去很多的工作；网关节省了你的时间，让你的应用程序更加可读，不易出错。</p>
<p>## 用法</p>
<p>我们将马上描述应用程序可用的连接选项的[全集](#选项)；首先让我们看看他们如何被示例 MagnetoCorp <cite>issue</cite> 应用指定：</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>javascript
const userName = <a class="reference external" href="mailto:'User1&#37;&#52;&#48;org1&#46;example&#46;com">‘User1<span>&#64;</span>org1<span>&#46;</span>example<span>&#46;</span>com</a>’;
const wallet = new FileSystemWallet(‘../identity/user/isabella/wallet’);</p>
<dl>
<dt>const connectionOptions = {</dt><dd><p>identity: userName,
wallet: wallet,
eventHandlerOptions: {</p>
<blockquote>
<div><p>commitTimeout: 100,
strategy: EventStrategies.MSPID_SCOPE_ANYFORTX
}</p>
</div></blockquote>
<p>};</p>
</dd>
</dl>
<p>await gateway.connect(connectionProfile, connectionOptions);
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>看一下 <cite>identity</cite> 和 <cite>wallet</cite> 选项是 <cite>connectionOptions</cite> 对象的简单属性。他们分别有 <cite>userName</cite> and <cite>wallet</cite>，他们较早的被设置在代码里。相比于这些属性，<cite>eventHandlerOptions</cite> 本身就是一个独立的对象。它有两个属性：<cite>commitTimeout: 100</cite> （以秒为单位）和 <cite>strategy:EventStrategies.MSPID_SCOPE_ANYFORTX</cite>。</p>
<p>看一下 <cite>connectionOptions</cite> 如何作为一个 <cite>connectionProfile</cite> 的补充被传递给网关的；网络被网络配置文件所标识，这些选项精确地指定了网关该如何与它交互。现在让我们看下可用选项。</p>
<p>## 选项</p>
<p>这里是可用选项的列表以及他们的作用。</p>
<ul>
<li><p><cite>wallet</cite>  标识了将要被应用程序上的网关所使用的钱包。看一下交互**1**，钱包是由应用程序指定的，但它实际上是检索身份的网关。</p>
<p>一个钱包必须被指定；最重要的决定是钱包使用的[类型](./wallet.html#type)，是文件系统、内存、HSM 还是数据库。</p>
</li>
<li><p><cite>identity</cite>  应用程序从 <cite>wallet</cite> 中使用的用户身份。看一下交互**2a**；用户身份被应用程序指定，也代表了应用程序的用户 Isabella，<strong>2b</strong>。身份实际上被网络检索。</p>
<p>在我们的例子中，Isabella 的身份将会被不同的 MSP（<strong>2c</strong>，<strong>2d</strong>）使用，用于确定他为来自 MagnetoCorp 的一员，并且在其中扮演着一个特殊的角色。这两个事实将相应地决定了他在资源上的许可。</p>
<p>一个用户的身份必须被指定。正如你所看到的，这个身份对于 Hyperledger Fabric 是一个*有权限的*网络的概念来说是基本的原则——所有的操作者有一个身份，包括应用程序、Peer 节点和排序节点，这些身份决定了他们在资源上的控制。你可以在成员身份服务[话题](../membership/membership.html)中阅读更过关于这方面的概念。</p>
</li>
<li><p><cite>clientTIsIdentity</cite> 是可以从钱包（<strong>3a</strong>）获取到的身份，用于确保网关和不同的t通道组件之间的交流（<strong>3b</strong>），比如 Peer 节点和排序节点。</p>
<p>注意：这个身份不同于用户身份。即使 <cite>clientTlsIdentity</cite> 对于安全通信来说很重要，但它并不像用户身份那样基础，因为它的范围没有超过确保网络的通信。</p>
<p><cite>clientTlsIdentity</cite> 是可选项。建议你把它设置进生产环境中。你应该也使用不同的 <cite>clientTlsIdentity</cite> 用做 <cite>identity</cite>，因为这些身份有着非常不同的意义和生命周期。例如，如果 <cite>clientTIsIdentity</cite> 被破坏，那么你的 <cite>identity</cite> 也会被破坏；让他们保持分离会更加安全。</p>
</li>
<li><p><cite>eventHandlerOptions.commitTimeout</cite> 是可选的。它以秒为单位指定网关在将控制权返回给应用程序之前，应该等待任何对等方提交事务的最大时间量(<strong>4a</strong>)。用于通知的 Peer 节点集合由 ` eventHandlerOptions` 选项决定。如果没有指定 commitTimeout，网关默认将使用300秒的超时。</p></li>
<li><p><cite>eventHandlerOptions.strategy</cite> 是可选的。它定义了网关用来监听交易被提交通知的 Peer 节点集合。例如，是监听组织中的单一的 Peer 节点还是全部的节点。可以采用以下参数之一：</p>
<ul>
<li><p><cite>EventStrategies.MSPID_SCOPE_ANYFORTX</cite> 监听用户组织内的**一些** Peer 节点。在我们的例子中，看一下交互点**4b**；MagnetoCorp 中的 peer1、peer2、peer3 节点能够通知网关。</p></li>
<li><p><cite>EventStrategies.MSPID_SCOPE_ALLFORTX</cite> <strong>这是一个默认值</strong>。监听用户组织内的**所有** Peer 节点。在我们例子中，看一下交互点**4b**。所有来自 MagnetoCorp 的节点必须全部通知网关：peer1、peer2 和 peer3 节点。只有已知/被发现和可用的 Peer 节点才会被计入，停止或者失效的节点不包括在内。</p></li>
<li><p><cite>EventStrategies.NETWORK_SCOPE_ANYFORTX</cite> 监听整个网络通道内的**一些** Peer 节点。在我们的例子中，看一下交互点 <strong>4b</strong> 和 <strong>4c</strong>；MagnetoCorp 中部分 Peer 节点1-3 或者 DigiBank 的部分 Peer 节点 7-9 能够通知网关。</p></li>
<li><p><cite>EventStrategies.NETWORK_SCOPE_ALLFORTX</cite> 监听整个网络通道内**所有** Peer 节点。在我们的例子中，看一些交互 <strong>4b</strong> 和 <strong>4c</strong>。所有来自 MagnetoCorp 和 DigiBank 的 Peer 节点 1-3  和 Peer 节点 7-9 都必须通知网关。只有已知/被发现和可用的 Peer 节点才会被计入，停止或者失效的节点不包括在内。</p></li>
<li><p>&lt;<cite>PluginEventHandlerFunction</cite>&gt; 用户定义的事件处理器的名字。这个允许用户针对事件处理而定义他们自己的逻辑。看一下如何[定义](<a class="reference external" href="https://hyperledger.github.io/fabric-sdk-node/master/tutorial-transaction-commit-events.html">https://hyperledger.github.io/fabric-sdk-node/master/tutorial-transaction-commit-events.html</a>)一个时间处理器插件，并检验一个[示例处理器](<a class="reference external" href="https://github.com/hyperledger/fabric-sdk-node/blob/master/test/integration/network-e2e/sample-transaction-event-handler.js">https://github.com/hyperledger/fabric-sdk-node/blob/master/test/integration/network-e2e/sample-transaction-event-handler.js</a>)。</p>
<blockquote>
<div><p>如果你有一个迫切需要事件处理的需求的话，那么用户定义的事件处理器是有必要的；大体上来说，一个内建的事件策略是足够的。一个用户定义的事件处理器的例子可能是等待超过半数的组织内的 Peer 节点，以去确认交易被提交。</p>
</div></blockquote>
</li>
</ul>
<p>如果你确实指定了一个用户定义的事件处理器，她不会影响你的一个应用程序的逻辑；它是完全独立的。处理器被处理过程中的SDK调用；它决定了什么时候调用它，并且使用它的处理结果去选择哪个 Peer 节点用于事件通知。当SDK完成它的处理的时候，应用程序收到控制。</p>
<p>如果一个用户定义的事件处理器没有被指定，那么 <a href="#id9"><span class="problematic" id="id10">`</span></a>EventStrategies`的默认值将会被使用。</p>
</li>
<li><p><cite>discovery.enabled</cite> 是可选项，可能的值是 <cite>true</cite> 还是 <cite>false</cite>。默认是 <cite>ture</cite>。它决定了网关是否使用[服务发现](../discovery-overview.html)去增加连接配置文件里指定的网络拓扑。看一下交互点**6**；peer 节点的 gossip 信息会被网关使用。</p>
<p>这个值会被 <cite>INITIALIIZE-WITH-DISCOVERY</cite> 的环境变量覆盖，其值可以被设置成 <cite>true</cite> 或者 <cite>false</cite>。</p>
</li>
<li><p><cite>discovery.asLocalhost</cite> 是可选项，可能的值是 <cite>true`或者 `false</cite>。默认是`true`。它决定在服务发现期间发现的 IP 地址是否从 docker 网络传递给本地主机。</p>
<p>通常，开发人员将为其网络组件（如 Peer 节点、排序节点 和 CA 节点）编写使用 docker 容器的应用程序，但是他们自己本身不会运行在 docker 容器内。这个就是为什么 <cite>true</cite> 是默认的，这生产环境中，应用程序很可能以网络组件相同的方式运行在 docker 中，因此不需要地址转换。在这种情况下，应用程序应该要不明确指定 <cite>false</cite>，要不使用环境变量来覆盖。</p>
<p>这个值会被 <cite>DISCOVERY-AS-LOCALHOST</cite> 环境变量覆盖，其值可以被设置成 <cite>true</cite> 或者 <cite>false</cite>。</p>
</li>
</ul>
<p>## 注意事项</p>
<p>当打算选择连接选项的时候，下面的事项列表是有帮助的。</p>
<ul>
<li><p><cite>eventHandlerOptions.commitTimeout</cite> 和 <cite>eventHandlerOptions.strategy</cite> 协同工作。例如，<cite>commitTimeout: 100</cite> 和 <cite>strategy:EventStrategies.MSPID_SCOPE_ANYFORTX</cite> 意味着网关最多等待100秒，使得*一些*  Peer 节点确定交易被提交。相反，指定 <cite>strategy:  EventStrategies.NETWORK_SCOPE_ALLFORTX</cite> 意味着网关将会等待*所有*组织里的*所有* Peer 节点100秒。</p></li>
<li><p><cite>eventHandlerOptions.strategy:EventStrategies.MSPID_SCOPE_ALLFORTX</cite> 的默认值将等待应用程序内的组织的所有 Peer 节点提交提交交易。这是一个好的默认设置，因为应用程序能够确保所有的节点有一个最新账本的拷贝，最小的并发性问题&lt;!– Add a link with more information explaining this topic–&gt;。</p>
<p>然而，当组织内的 Peer 节点数量增加，等待所有 Peer 节点则没有必要，在这种情况下，使用一个可插拔的事件处理器能够提供更多有效果的策略。例如，在一个公式能够保持所有帐本同步的安全假设下，相同的 Peer 节点集合能够用于提交交易和监听通知。</p>
</li>
<li><p>服务发现要求 <cite>clientTlsIdentity</cite> 被设置。因为与应用程序有交换信息的 Peer 节点需要确信他们在与信任的实体交换信息。如果 <cite>clientTlsIdentity</cite> 没有被设置，那么 <cite>discovery</cite> 不会生效，不管它是否被设置。</p></li>
<li><p>即使应用程序在连接网关时能够设置连接选项，但是管理员可能需要覆盖这些选项。这是因为选项与网络交互有关，而网络交互可能随时间而变化。例如，管理员试图了解使用服务发现对网络性能的影响。</p>
<p>一个好的方式是在一个配置文件中定义应用程序覆盖，此文件在配置与网关的连接的时候，会被应用程序读取。</p>
<p>因为服务发现选项 <cite>enabled</cite> 和 <cite>asLocalHost</cite> 最容易被管理员频繁的覆盖，环境变量 <cite>INITIALIIZE-WITH-DISCOVERY</cite> 和 <cite>DISCOVERY-AS-LOCALHOST</cite>  是因为方便而提供的。管理员应该在应用程序的生产环境中设置他们，其生产环境很可能是一个 docker 容器。</p>
</li>
</ul>
<p>&lt;!— Licensed under Creative Commons Attribution 4.0 International License
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a> –&gt;</p>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="wallet.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="connectionprofile.html" class="btn btn-neutral" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
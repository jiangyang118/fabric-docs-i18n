

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>&lt;no title&gt; &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="create_channel_config.html" />
    <link rel="prev" title="创建通道" href="create_channel_overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">Hyperledger Fabric v2.0 更新说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#id7">发行说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">关键概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developapps/developing_applications.html">开发应用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_guide_overview.html">部署一个生产网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">操作指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">升级到最新版本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">命令参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">架构参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">欢迎贡献！</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">版本发布</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">仍有问题？</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">状态</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../tutorials.html">教程</a> &raquo;</li>
        
          <li><a href="create_channel_overview.html">创建通道</a> &raquo;</li>
        
      <li>&lt;no title&gt;</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/create_channel/create_channel.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p># 创建新通道</p>
<p>您可以使用本教程来学习如何使用[configtxgen](../commands/configtxgen.html) CLI工具创建新通道，然后使用[peer channel](../commands/peerchannel.html)命令让您的Peer节点加入该通道。尽管本教程将利用Fabric测试网络来创建新通道，但是本教程中的步骤生产环境中的网络运维人员也可以使用。</p>
<p>在创建通道的过程中，本教程将带您逐个了解以下步骤和概念：</p>
<ul class="simple">
<li><p>[配置configtxgen工具](#setting-up-the-configtxgen-tool)</p></li>
<li><p>[使用configtx.yaml](#the-configtx-yaml-file)</p></li>
<li><p>[Orderer系统通道](#the-orderer-system-channel)</p></li>
<li><p>[创建应用通道](#creating-an-application-channel)</p></li>
<li><p>[Peer加入通道](#join-peers-to-the-channel)</p></li>
<li><p>[设置锚节点]](#set-anchor-peers)</p></li>
</ul>
<p>## 配置configtxgen工具</p>
<p>通过构建通道创建交易并将交易提交给排序服务来创建通道。通道创建交易指定通道的初始配置，并由排序服务用于写入通道创世块。尽管可以手动构建通道创建交易文件，但使用[configtxgen](../commands/configtxgen.html)工具会更容易。该工具通过读取定义通道配置的`configtx.yaml`文件，然后将相关信息写入通道创建交易中来工作。在下一节讨论`configtx.yaml`文件之前，我们可以先开始下载并配置好`configtxgen`工具。</p>
<p>您可以按照[安装示例，二进制文件和Docker镜像](../install.html)的步骤下载`configtxgen`二进制文件。<a href="#id1"><span class="problematic" id="id2">`</span></a>configtxgen`和其他Fabric工具一起将被下载到本地fabric-samples的`bin`文件夹中。</p>
<p>对于本教程，我们将要在`fabric-samples`目录下的`test-network`目录中进行操作。使用以下命令进入到该目录：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">fabric-samples/test-network</span>
<span class="pre">`</span></code></p>
<p>在本教程的其余部分中，我们将在`test-network`目录进行操作。使用以下命令将configtxgen工具添加到您的CLI路径：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">PATH=${PWD}/../bin:$PATH</span>
<span class="pre">`</span></code></p>
<p>为了使用`configtxgen`，您需要将`FABRIC_CFG_PATH`环境变量设置为本地包含`configtx.yaml`文件的目录的路径。在本教程中，我们将在`configtx`文件夹中引用用于设置Fabric测试网络的`configtx.yaml`：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">FABRIC_CFG_PATH=${PWD}/configtx</span>
<span class="pre">`</span></code></p>
<p>您可以通过打印`configtxgen`帮助文本来检查是否可以使用该工具：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxgen</span> <span class="pre">--help</span>
<span class="pre">`</span></code></p>
<p>## 使用configtx.yaml</p>
<p><a href="#id3"><span class="problematic" id="id4">`</span></a>configtx.yaml`文件指定新通道的**通道配置**。建立通道配置所需的信息在`configtx.yaml`文件中以读写友好的形式指定。<a href="#id5"><span class="problematic" id="id6">`</span></a>configtxgen`工具使用`configtx.yaml`文件中定义的通道配置文件来创建通道配置，并将其写入[protobuf格式](<a class="reference external" href="https://developers.google.com/protocol-buffers">https://developers.google.com/protocol-buffers</a>)，然后由Fabric读取。</p>
<p>您可以在`test-network`目录下的`configtx`文件夹中找到`configtx.yaml`文件，该文件用于部署测试网络。该文件包含以下信息，我们将使用这些信息来创建新通道：</p>
<ul class="simple">
<li><p><strong>Organizations:</strong> 可以成为您的通道成员的组织。每个组织都有对用于建立[通道MSP](../membership/membership.html)的密钥信息的引用。</p></li>
<li><p><strong>Ordering service:</strong> 哪些排序节点将构成网络的排序服务，以及它们将用于同意一致交易顺序的共识方法。该文件还包含将成为排序服务管理员的组织。</p></li>
<li><p><strong>Channel policies:</strong> 文件的不同部分共同定义策略，这些策略将控制组织与通道的交互方式以及哪些组织需要批准通道更新。就本教程而言，我们将使用Fabric使用的默认策略。</p></li>
<li><p><strong>Channel profiles:</strong> 每个通道配置文件都引用`configtx.yaml`文件其他部分的信息来构建通道配置。使用预设文件来创建Orderer系统通道的创世块以及将被Peer组织使用的通道。为了将它们与系统通道区分开来，Peer组织使用的通道通常称为应用通道。</p></li>
</ul>
<p><a href="#id7"><span class="problematic" id="id8">`</span></a>configtxgen`工具使用`configtx.yaml`文件为系统通道创建完整的创世块。因此，系统通道配置文件需要指定完整的系统通道配置。用于创建通道创建交易的通道配置文件仅需要包含创建应用通道所需的其他配置信息。</p>
<p>您可以访问[使用configtx.yaml创建通道创世块](create_channel_genesis.html)教程，以了解有关此文件的更多信息。现在，我们将返回创建通道的操作方面，尽管在后续的步骤中将引用此文件的某些部分。</p>
<p>## 启动网络</p>
<p>我们将使用正在运行的Fabric测试网络来创建新通道。出于本教程的考虑，我们希望从一个已知的初始状态进行操作。以下命令将停掉所有容器并删除任何之前生成的文件。确保您仍在本地`fabric-samples`的`test-network`目录中进行操作。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">./network.sh</span> <span class="pre">down</span>
<span class="pre">`</span></code></p>
<p>您可以使用以下命令来启动测试网络：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">./network.sh</span> <span class="pre">up</span>
<span class="pre">`</span></code></p>
<p>这个命令将使用在`configtx.yaml`文件中定义的两个Peer组织和单个Orderer组织创建一个Fabric网络。Peer组织将各自运营一个Peer节点，而排序服务管理员将运营单个Orderer节点。运行命令时，脚本将打印出正在创建的节点的日志：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">Creating</span> <span class="pre">network</span> <span class="pre">&quot;net_test&quot;</span> <span class="pre">with</span> <span class="pre">the</span> <span class="pre">default</span> <span class="pre">driver</span>
<span class="pre">Creating</span> <span class="pre">volume</span> <span class="pre">&quot;net_orderer.example.com&quot;</span> <span class="pre">with</span> <span class="pre">default</span> <span class="pre">driver</span>
<span class="pre">Creating</span> <span class="pre">volume</span> <span class="pre">&quot;net_peer0.org1.example.com&quot;</span> <span class="pre">with</span> <span class="pre">default</span> <span class="pre">driver</span>
<span class="pre">Creating</span> <span class="pre">volume</span> <span class="pre">&quot;net_peer0.org2.example.com&quot;</span> <span class="pre">with</span> <span class="pre">default</span> <span class="pre">driver</span>
<span class="pre">Creating</span> <span class="pre">orderer.example.com</span>&#160;&#160;&#160; <span class="pre">...</span> <span class="pre">done</span>
<span class="pre">Creating</span> <span class="pre">peer0.org2.example.com</span> <span class="pre">...</span> <span class="pre">done</span>
<span class="pre">Creating</span> <span class="pre">peer0.org1.example.com</span> <span class="pre">...</span> <span class="pre">done</span>
<span class="pre">CONTAINER</span> <span class="pre">ID</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">IMAGE</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">COMMAND</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">CREATED</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">STATUS</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">PORTS</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">NAMES</span>
<span class="pre">8d0c74b9d6af</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">hyperledger/fabric-orderer:latest</span>&#160;&#160; <span class="pre">&quot;orderer&quot;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">4</span> <span class="pre">seconds</span> <span class="pre">ago</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Up</span> <span class="pre">Less</span> <span class="pre">than</span> <span class="pre">a</span> <span class="pre">second</span>&#160;&#160; <span class="pre">0.0.0.0:7050-&gt;7050/tcp</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">orderer.example.com</span>
<span class="pre">ea1cf82b5b99</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">hyperledger/fabric-peer:latest</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&quot;peer</span> <span class="pre">node</span> <span class="pre">start&quot;</span>&#160;&#160; <span class="pre">4</span> <span class="pre">seconds</span> <span class="pre">ago</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Up</span> <span class="pre">Less</span> <span class="pre">than</span> <span class="pre">a</span> <span class="pre">second</span>&#160;&#160; <span class="pre">0.0.0.0:7051-&gt;7051/tcp</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">peer0.org1.example.com</span>
<span class="pre">cd8d9b23cb56</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">hyperledger/fabric-peer:latest</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&quot;peer</span> <span class="pre">node</span> <span class="pre">start&quot;</span>&#160;&#160; <span class="pre">4</span> <span class="pre">seconds</span> <span class="pre">ago</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Up</span> <span class="pre">1</span> <span class="pre">second</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">7051/tcp,</span> <span class="pre">0.0.0.0:9051-&gt;9051/tcp</span>&#160;&#160; <span class="pre">peer0.org2.example.com</span>
<span class="pre">`</span></code></p>
<p>我们测试网络实例的部署没有创建应用通道。但是，当您执行`./network.sh up`命令时，测试网络脚本会创建系统通道。在底层，脚本使用`configtxgen`工具和`configtx.yaml`文件构建系统通道的创世块。因为系统通道用于创建其他通道，所以在创建应用通道之前，我们需要花一些时间来了解Orderer系统通道。</p>
<p>## Orderer系统通道</p>
<p>在Fabric网络中创建的第一个通道是系统通道。系统通道定义了形成排序服务的Orderer节点集合和充当排序服务管理员的组织集合。</p>
<p>系统通道还包括属于区块链[联盟](../glossary.html#consortium)的组织。联盟是一组Peer组织，它们属于系统通道，但不是排序服务的管理员。联盟成员可以创建新通道，并包括其他联盟组织作为通道成员。</p>
<p>要部署新的排序服务，需要系统通道的创世块。当您执行`./network.sh up`命令时，测试网络脚本已经创建了系统通道创世块。创世块用于部署单个Orderer节点，该Orderer节点使用该块创建系统通道并形成网络的排序服务。如果检查`./ network.sh`脚本的输出，则可以在日志中找到创建创世块的命令：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxgen</span> <span class="pre">-profile</span> <span class="pre">TwoOrgsOrdererGenesis</span> <span class="pre">-channelID</span> <span class="pre">system-channel</span> <span class="pre">-outputBlock</span> <span class="pre">./system-genesis-block/genesis.block</span>
<span class="pre">`</span></code></p>
<p><a href="#id9"><span class="problematic" id="id10">`</span></a>configtxgen`工具使用来自`configtx.yaml`的`TwoOrgsOrdererGenesis`通道配置文件来写入创世块并将其存储在`system-genesis-block`文件夹中。 您可以在下面看到`TwoOrgsOrdererGenesis`配置文件：</p>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">`</span></a>yaml
TwoOrgsOrdererGenesis:</p>
<blockquote>
<div><p>&lt;&lt;: <a href="#id15"><span class="problematic" id="id16">*</span></a>ChannelDefaults
Orderer:</p>
<blockquote>
<div><p>&lt;&lt;: <a href="#id17"><span class="problematic" id="id18">*</span></a>OrdererDefaults
Organizations:</p>
<blockquote>
<div><ul class="simple">
<li><p><a href="#id19"><span class="problematic" id="id20">*</span></a>OrdererOrg</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Capabilities:</dt><dd><p>&lt;&lt;: <a href="#id21"><span class="problematic" id="id22">*</span></a>OrdererCapabilities</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Consortiums:</dt><dd><dl class="simple">
<dt>SampleConsortium:</dt><dd><dl class="simple">
<dt>Organizations:</dt><dd><ul class="simple">
<li><p><a href="#id23"><span class="problematic" id="id24">*</span></a>Org1</p></li>
<li><p><a href="#id25"><span class="problematic" id="id26">*</span></a>Org2</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p><a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">`</span></a></p>
<p>配置文件的`Orderer:` 部分创建测试网络使用的单节点Raft排序服务，并以`OrdererOrg`作为排序服务管理员。配置文件的`Consortiums`部分创建了一个名为`SampleConsortium:` 的Peer组织的联盟。 这两个Peer组织Org1和Org2都是该联盟的成员。因此，我们可以将两个组织都包含在测试网络创建的新通道中。如果我们想添加另一个组织作为通道成员而又不将该组织添加到联盟中，则我们首先需要使用Org1和Org2创建通道，然后通过[更新通道配置](../channel_update_tutorial.html)添加该组织。</p>
<p>## 创建应用通道</p>
<p>现在我们已经部署了网络的节点并使用`network.sh`脚本创建了Orderer系统通道，我们可以开始为Peer组织创建新通道。我们已经设置了使用`configtxgen`工具所需的环境变量。运行以下命令为`channel1`创建一个创建通道的交易：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxgen</span> <span class="pre">-profile</span> <span class="pre">TwoOrgsChannel</span> <span class="pre">-outputCreateChannelTx</span> <span class="pre">./channel-artifacts/channel1.tx</span> <span class="pre">-channelID</span> <span class="pre">channel1</span>
<span class="pre">`</span></code></p>
<p><cite>-channelID`是将要创建的通道的名称。通道名称必须全部为小写字母，少于250个字符，并且与正则表达式``[a-z][a-z0-9.-]*``匹配。该命令使用</cite>-profile`标志来引用`configtx.yaml`中的`TwoOrgsChannel:<a href="#id31"><span class="problematic" id="id32">`</span></a>配置文件，测试网络使用它来创建应用通道：</p>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a>yaml
TwoOrgsChannel:</p>
<blockquote>
<div><p>Consortium: SampleConsortium
&lt;&lt;: <a href="#id37"><span class="problematic" id="id38">*</span></a>ChannelDefaults
Application:</p>
<blockquote>
<div><p>&lt;&lt;: <a href="#id39"><span class="problematic" id="id40">*</span></a>ApplicationDefaults
Organizations:</p>
<blockquote>
<div><ul class="simple">
<li><p><a href="#id41"><span class="problematic" id="id42">*</span></a>Org1</p></li>
<li><p><a href="#id43"><span class="problematic" id="id44">*</span></a>Org2</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Capabilities:</dt><dd><p>&lt;&lt;: <a href="#id45"><span class="problematic" id="id46">*</span></a>ApplicationCapabilities</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p><a href="#id47"><span class="problematic" id="id48">``</span></a><a href="#id49"><span class="problematic" id="id50">`</span></a></p>
<p>该配置文件从系统通道引用`SampleConsortium`的名称，并且包括来自该联盟的两个Peer组织作为通道成员。因为系统通道用作创建应用通道的模板，所以系统通道中定义的排序节点成为新通道的默认[共识者集合](../glossary.html#consenter-set)。排序服务的管理员成为该通道的Orderer管理员。可以使用通道更新在共识者者集合中添加或删除Orderer节点和Orderer组织。</p>
<p>如果命令执行成功，您将看到`configtxgen`的日志加载`configtx.yaml`文件并打印通道创建交易：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-03-11</span> <span class="pre">16:37:12.695</span> <span class="pre">EDT</span> <span class="pre">[common.tools.configtxgen]</span> <span class="pre">main</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">001</span> <span class="pre">Loading</span> <span class="pre">configuration</span>
<span class="pre">2020-03-11</span> <span class="pre">16:37:12.738</span> <span class="pre">EDT</span> <span class="pre">[common.tools.configtxgen.localconfig]</span> <span class="pre">Load</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">002</span> <span class="pre">Loaded</span> <span class="pre">configuration:</span> <span class="pre">/Usrs/fabric-samples/test-network/configtx/configtx.yaml</span>
<span class="pre">2020-03-11</span> <span class="pre">16:37:12.740</span> <span class="pre">EDT</span> <span class="pre">[common.tools.configtxgen]</span> <span class="pre">doOutputChannelCreateTx</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">003</span> <span class="pre">Generating</span> <span class="pre">new</span> <span class="pre">channel</span> <span class="pre">configtx</span>
<span class="pre">2020-03-11</span> <span class="pre">16:37:12.789</span> <span class="pre">EDT</span> <span class="pre">[common.tools.configtxgen]</span> <span class="pre">doOutputChannelCreateTx</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">004</span> <span class="pre">Writing</span> <span class="pre">new</span> <span class="pre">channel</span> <span class="pre">tx</span>
<span class="pre">`</span></code></p>
<p>我们可以使用`peer` CLI将通道创建交易提交给排序服务。要使用`peer` CLI，我们需要将`FABRIC_CFG_PATH`设置为`fabric-samples/config`目录中的`core.yaml`文件。通过运行以下命令来设置`FABRIC_CFG_PATH`环境变量：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">FABRIC_CFG_PATH=$PWD/../config/</span>
<span class="pre">`</span></code></p>
<p>在排序服务创建通道之前，排序服务将检查提交请求的身份的许可。默认情况下，只有属于系统通道的联盟组织的管理员身份才能创建新通道。发出以下命令，以Org1中的admin用户身份运行`peer` CLI：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ENABLED=true</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/org1.example.com/users/Admin&#64;org1.example.com/msp</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_ADDRESS=localhost:7051</span>
<span class="pre">`</span></code></p>
<p>现在，您可以使用以下命令创建通道：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">create</span> <span class="pre">-o</span> <span class="pre">localhost:7050</span>&#160; <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">-c</span> <span class="pre">channel1</span> <span class="pre">-f</span> <span class="pre">./channel-artifacts/channel1.tx</span> <span class="pre">--outputBlock</span> <span class="pre">./channel-artifacts/channel1.block</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span>
<span class="pre">`</span></code></p>
<p>上面的命令使用`-f`标志提供通道创建交易文件的路径，并使用`-c`标志指定通道名称。<cite>-o`标志用于选择将用于创建通道的排序节点。</cite>–cafile`是Orderer节点的TLS证书的路径。当您运行`peer channel create`命令时，<cite>peer</cite> CLI将生成以下响应：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-03-06</span> <span class="pre">17:33:49.322</span> <span class="pre">EST</span> <span class="pre">[channelCmd]</span> <span class="pre">InitCmdFactory</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">00b</span> <span class="pre">Endorser</span> <span class="pre">and</span> <span class="pre">orderer</span> <span class="pre">connections</span> <span class="pre">initialized</span>
<span class="pre">2020-03-06</span> <span class="pre">17:33:49.550</span> <span class="pre">EST</span> <span class="pre">[cli.common]</span> <span class="pre">readBlock</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">00c</span> <span class="pre">Received</span> <span class="pre">block:</span> <span class="pre">0</span>
<span class="pre">`</span></code></p>
<p>由于我们使用的是Raft排序服务，因此您可能会收到一些状态不可用的消息，您可以放心地忽略它们。该命令会将新通道的创世块返回到`–outputBlock`标志指定的位置。</p>
<p>## Peer加入通道</p>
<p>创建通道后，我们可以让Peer加入通道。属于该通道成员的组织可以使用[peer channel fetch](../commands/peerchannel.html#peer-channel-fetch)命令从排序服务中获取通道创世块。然后，组织可以使用创世块，通过[peer channel join](../commands/peerchannel.html#peer-channel-join)命令将Peer加入到该通道。一旦Peer加入通道，Peer将通过从排序服务中获取通道上的其他区块来构建区块链账本。</p>
<p>由于我们已经以Org1管理员的身份使用`peer` CLI，因此让我们将Org1的Peer加入到通道中。由于Org1提交了通道创建交易，因此我们的文件系统上已经有了通道创世块。使用以下命令将Org1的Peer加入通道。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">join</span> <span class="pre">-b</span> <span class="pre">./channel-artifacts/channel1.block</span>
<span class="pre">`</span></code></p>
<p>环境变量`CORE_PEER_ADDRESS`已设置为以`peer0.org1.example.com`为目标。命令执行成功后将生成`peer0.org1.example.com`加入通道的响应：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-03-06</span> <span class="pre">17:49:09.903</span> <span class="pre">EST</span> <span class="pre">[channelCmd]</span> <span class="pre">InitCmdFactory</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">001</span> <span class="pre">Endorser</span> <span class="pre">and</span> <span class="pre">orderer</span> <span class="pre">connections</span> <span class="pre">initialized</span>
<span class="pre">2020-03-06</span> <span class="pre">17:49:10.060</span> <span class="pre">EST</span> <span class="pre">[channelCmd]</span> <span class="pre">executeJoin</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">002</span> <span class="pre">Successfully</span> <span class="pre">submitted</span> <span class="pre">proposal</span> <span class="pre">to</span> <span class="pre">join</span> <span class="pre">channel</span>
<span class="pre">`</span></code></p>
<p>您可以使用[peer channel getinfo](../commands/peerchannel.html#peer-channel-getinfo)命令验证Peer是否已加入通道：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">getinfo</span> <span class="pre">-c</span> <span class="pre">channel1</span>
<span class="pre">`</span></code></p>
<p>该命令将列出通道的区块高度和最新区块的哈希。由于创世块是通道上的唯一区块，因此通道的高度将为1：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-03-13</span> <span class="pre">10:50:06.978</span> <span class="pre">EDT</span> <span class="pre">[channelCmd]</span> <span class="pre">InitCmdFactory</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">001</span> <span class="pre">Endorser</span> <span class="pre">and</span> <span class="pre">orderer</span> <span class="pre">connections</span> <span class="pre">initialized</span>
<span class="pre">Blockchain</span> <span class="pre">info:</span> <span class="pre">{&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;kvtQYYEL2tz0kDCNttPFNC4e6HVUFOGMTIDxZ+DeNQM=&quot;}</span>
<span class="pre">`</span></code></p>
<p>现在，我们可以将Org2的Peer加入通道。设置以下环境变量，以Org2管理员的身份运行`peer` CLI。环境变量还将把Org2的Peer <a href="#id51"><span class="problematic" id="id52">`</span></a>peer0.org1.example.com`设置为目标Peer。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ENABLED=true</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/org2.example.com/users/Admin&#64;org2.example.com/msp</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_ADDRESS=localhost:9051</span>
<span class="pre">`</span></code></p>
<p>尽管我们的文件系统上仍然有通道创世块，但在更现实的场景下，Org2将从排序服务中获取块。例如，我们将使用`peer channel fetch`命令来获取Org2的创世块：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">fetch</span> <span class="pre">0</span> <span class="pre">./channel-artifacts/channel_org2.block</span> <span class="pre">-o</span> <span class="pre">localhost:7050</span> <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">-c</span> <span class="pre">channel1</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span>
<span class="pre">`</span></code></p>
<p>该命令使用`0`来指定它需要获取加入通道所需的创世块。如果命令成功执行，则应该看到以下输出：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-03-13</span> <span class="pre">11:32:06.309</span> <span class="pre">EDT</span> <span class="pre">[channelCmd]</span> <span class="pre">InitCmdFactory</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">001</span> <span class="pre">Endorser</span> <span class="pre">and</span> <span class="pre">orderer</span> <span class="pre">connections</span> <span class="pre">initialized</span>
<span class="pre">2020-03-13</span> <span class="pre">11:32:06.336</span> <span class="pre">EDT</span> <span class="pre">[cli.common]</span> <span class="pre">readBlock</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">002</span> <span class="pre">Received</span> <span class="pre">block:</span> <span class="pre">0</span>
<span class="pre">`</span></code></p>
<p>该命令返回通道生成块并将其命名为`channel_org2.block`，以将其与由Org1拉取的块区分开。现在，您可以使用该块将Org2的Peer加入该通道：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">join</span> <span class="pre">-b</span> <span class="pre">./channel-artifacts/channel_org2.block</span>
<span class="pre">`</span></code></p>
<p>## 配置锚节点</p>
<p>组织的Peer加入通道后，他们应至少选择一个Peer成为锚定节点。为了利用诸如私有数据和服务发现之类的功能，需要[Peer锚节点](../gossip.html#anchor-peers)。每个组织都应在一个通道上设置多个锚节点以实现冗余。有关Gossip和Peer锚节点的更多信息，请参见[Gossip数据分发协议](../gossip.html)。</p>
<p>通道配置中包含每个组织的Peer锚节点的端点信息。每个通道成员可以通过更新通道来指定其Peer锚节点。我们将使用[configtxlator](../commands/configtxlator.html)工具更新通道配置，并为Org1和Org2选择锚节点。设置Peer锚节点的过程与进行其他通道更新所需的步骤相似，并介绍了如何使用`configtxlator` [更新通道配置](../config_update.html)。您还需要在本地计算机上安装[jq工具](<a class="reference external" href="https://stedolan.github.io/jq/">https://stedolan.github.io/jq/</a>)。</p>
<p>我们将从选择一个Peer锚节点作为Org1开始。第一步是使用`peer channel fetch`命令来获取最新的通道配置块。设置以下环境变量，以Org1 管理员身份运行`peer` CLI：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">FABRIC_CFG_PATH=$PWD/../config/</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ENABLED=true</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/org1.example.com/users/Admin&#64;org1.example.com/msp</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_ADDRESS=localhost:7051</span>
<span class="pre">`</span></code></p>
<p>您可以使用以下命令来获取通道配置：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">fetch</span> <span class="pre">config</span> <span class="pre">channel-artifacts/config_block.pb</span> <span class="pre">-o</span> <span class="pre">localhost:7050</span> <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">-c</span> <span class="pre">channel1</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span>
<span class="pre">`</span></code></p>
<p>由于最新的通道配置块是通道创世块，因此您将看到该通道的命令返回块0。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-04-15</span> <span class="pre">20:41:56.595</span> <span class="pre">EDT</span> <span class="pre">[channelCmd]</span> <span class="pre">InitCmdFactory</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">001</span> <span class="pre">Endorser</span> <span class="pre">and</span> <span class="pre">orderer</span> <span class="pre">connections</span> <span class="pre">initialized</span>
<span class="pre">2020-04-15</span> <span class="pre">20:41:56.603</span> <span class="pre">EDT</span> <span class="pre">[cli.common]</span> <span class="pre">readBlock</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">002</span> <span class="pre">Received</span> <span class="pre">block:</span> <span class="pre">0</span>
<span class="pre">2020-04-15</span> <span class="pre">20:41:56.603</span> <span class="pre">EDT</span> <span class="pre">[channelCmd]</span> <span class="pre">fetch</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">003</span> <span class="pre">Retrieving</span> <span class="pre">last</span> <span class="pre">config</span> <span class="pre">block:</span> <span class="pre">0</span>
<span class="pre">2020-04-15</span> <span class="pre">20:41:56.608</span> <span class="pre">EDT</span> <span class="pre">[cli.common]</span> <span class="pre">readBlock</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">004</span> <span class="pre">Received</span> <span class="pre">block:</span> <span class="pre">0</span>
<span class="pre">`</span></code></p>
<p>通道配置块存储在`channel-artifacts`文件夹中，以使更新过程与其他工件分开。进入到`channel-artifacts`文件夹以完成以下步骤：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">channel-artifacts</span>
<span class="pre">`</span></code></p>
<p>现在，我们可以开始使用`configtxlator`工具开始通道配置相关工作。第一步是将来自protobuf的块解码为可以读写友好的JSON对象。我们还将去除不必要的块数据，仅保留通道配置。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxlator</span> <span class="pre">proto_decode</span> <span class="pre">--input</span> <span class="pre">config_block.pb</span> <span class="pre">--type</span> <span class="pre">common.Block</span> <span class="pre">--output</span> <span class="pre">config_block.json</span>
<span class="pre">jq</span> <span class="pre">.data.data[0].payload.data.config</span> <span class="pre">config_block.json</span> <span class="pre">&gt;</span> <span class="pre">config.json</span>
<span class="pre">`</span></code></p>
<p>T这些命令将通道配置块转换为简化的JSON <cite>config.json</cite>，它将作为我们更新的基准。因为我们不想直接编辑此文件，所以我们将制作一个可以编辑的副本。我们将在以后的步骤中使用原始的通道配置。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cp</span> <span class="pre">config.json</span> <span class="pre">config_copy.json</span>
<span class="pre">`</span></code></p>
<p>您可以使用`jq`工具将Org1的Peer锚节点添加到通道配置中。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">jq</span> <span class="pre">'.channel_group.groups.Application.groups.Org1MSP.values</span> <span class="pre">+=</span> <span class="pre">{&quot;AnchorPeers&quot;:{&quot;mod_policy&quot;:</span> <span class="pre">&quot;Admins&quot;,&quot;value&quot;:{&quot;anchor_peers&quot;:</span> <span class="pre">[{&quot;host&quot;:</span> <span class="pre">&quot;peer0.org1.example.com&quot;,&quot;port&quot;:</span> <span class="pre">7051}]},&quot;version&quot;:</span> <span class="pre">&quot;0&quot;}}'</span> <span class="pre">config_copy.json</span> <span class="pre">&gt;</span> <span class="pre">modified_config.json</span>
<span class="pre">`</span></code></p>
<p>完成此步骤后，我们在`modified_config.json`文件中以JSON格式获取了通道配置的更新版本。现在，我们可以将原始和修改的通道配置都转换回protobuf格式，并计算它们之间的差异。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxlator</span> <span class="pre">proto_encode</span> <span class="pre">--input</span> <span class="pre">config.json</span> <span class="pre">--type</span> <span class="pre">common.Config</span> <span class="pre">--output</span> <span class="pre">config.pb</span>
<span class="pre">configtxlator</span> <span class="pre">proto_encode</span> <span class="pre">--input</span> <span class="pre">modified_config.json</span> <span class="pre">--type</span> <span class="pre">common.Config</span> <span class="pre">--output</span> <span class="pre">modified_config.pb</span>
<span class="pre">configtxlator</span> <span class="pre">compute_update</span> <span class="pre">--channel_id</span> <span class="pre">channel1</span> <span class="pre">--original</span> <span class="pre">config.pb</span> <span class="pre">--updated</span> <span class="pre">modified_config.pb</span> <span class="pre">--output</span> <span class="pre">config_update.pb</span>
<span class="pre">`</span></code></p>
<p>名为`channel_update.pb`的新的protobuf包含我们需要应用于通道配置的Peer锚节点更新。我们可以将配置更新包装在交易Envelope中，以创建通道配置更新交易。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxlator</span> <span class="pre">proto_decode</span> <span class="pre">--input</span> <span class="pre">config_update.pb</span> <span class="pre">--type</span> <span class="pre">common.ConfigUpdate</span> <span class="pre">--output</span> <span class="pre">config_update.json</span>
<span class="pre">echo</span> <span class="pre">'{&quot;payload&quot;:{&quot;header&quot;:{&quot;channel_header&quot;:{&quot;channel_id&quot;:&quot;channel1&quot;,</span> <span class="pre">&quot;type&quot;:2}},&quot;data&quot;:{&quot;config_update&quot;:'$(cat</span> <span class="pre">config_update.json)'}}}'</span> <span class="pre">|</span> <span class="pre">jq</span> <span class="pre">.</span> <span class="pre">&gt;</span> <span class="pre">config_update_in_envelope.json</span>
<span class="pre">configtxlator</span> <span class="pre">proto_encode</span> <span class="pre">--input</span> <span class="pre">config_update_in_envelope.json</span> <span class="pre">--type</span> <span class="pre">common.Envelope</span> <span class="pre">--output</span> <span class="pre">config_update_in_envelope.pb</span>
<span class="pre">`</span></code></p>
<p>现在，我们可以使用最终的工件`config_update_in_envelope.pb`来更新通道。回到`test-network`目录：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">..</span>
<span class="pre">`</span></code></p>
<p>我们可以通过向`peer channel update`命令提供新的通道配置来添加Peer锚节点。因为我们正在更新仅影响Org1的部分通道配置，所以其他通道成员不需要批准通道更新。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">update</span> <span class="pre">-f</span> <span class="pre">channel-artifacts/config_update_in_envelope.pb</span> <span class="pre">-c</span> <span class="pre">channel1</span> <span class="pre">-o</span> <span class="pre">localhost:7050</span>&#160; <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span>
<span class="pre">`</span></code></p>
<p>通道更新成功后，您应该看到以下响应：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">2020-01-09</span> <span class="pre">21:30:45.791</span> <span class="pre">UTC</span> <span class="pre">[channelCmd]</span> <span class="pre">update</span> <span class="pre">-&gt;</span> <span class="pre">INFO</span> <span class="pre">002</span> <span class="pre">Successfully</span> <span class="pre">submitted</span> <span class="pre">channel</span> <span class="pre">update</span>
<span class="pre">`</span></code></p>
<p>我们可以为Org2设置锚节点。因为我们是第二次进行该过程，所以我们将更快地完成这些步骤。 设置环境变量，以Org2管理员的身份运行`peer` CLI：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ENABLED=true</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/org2.example.com/users/Admin&#64;org2.example.com/msp</span>
<span class="pre">export</span> <span class="pre">CORE_PEER_ADDRESS=localhost:9051</span>
<span class="pre">`</span></code></p>
<p>拉取最新的通道配置块，这是该通道上的第二个块：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">fetch</span> <span class="pre">config</span> <span class="pre">channel-artifacts/config_block.pb</span> <span class="pre">-o</span> <span class="pre">localhost:7050</span> <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">-c</span> <span class="pre">channel1</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span>
<span class="pre">`</span></code></p>
<p>回到`channel-artifacts`目录：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">channel-artifacts</span>
<span class="pre">`</span></code></p>
<p>然后，您可以解码并复制配置块。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxlator</span> <span class="pre">proto_decode</span> <span class="pre">--input</span> <span class="pre">config_block.pb</span> <span class="pre">--type</span> <span class="pre">common.Block</span> <span class="pre">--output</span> <span class="pre">config_block.json</span>
<span class="pre">jq</span> <span class="pre">.data.data[0].payload.data.config</span> <span class="pre">config_block.json</span> <span class="pre">&gt;</span> <span class="pre">config.json</span>
<span class="pre">cp</span> <span class="pre">config.json</span> <span class="pre">config_copy.json</span>
<span class="pre">`</span></code></p>
<p>在通道配置中将加入通道的Org2的Peer添加为锚节点：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">jq</span> <span class="pre">'.channel_group.groups.Application.groups.Org2MSP.values</span> <span class="pre">+=</span> <span class="pre">{&quot;AnchorPeers&quot;:{&quot;mod_policy&quot;:</span> <span class="pre">&quot;Admins&quot;,&quot;value&quot;:{&quot;anchor_peers&quot;:</span> <span class="pre">[{&quot;host&quot;:</span> <span class="pre">&quot;peer0.org2.example.com&quot;,&quot;port&quot;:</span> <span class="pre">9051}]},&quot;version&quot;:</span> <span class="pre">&quot;0&quot;}}'</span> <span class="pre">config_copy.json</span> <span class="pre">&gt;</span> <span class="pre">modified_config.json</span>
<span class="pre">`</span></code></p>
<p>现在，我们可以将原始和更新的通道配置都转换回protobuf格式，并计算它们之间的差异。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxlator</span> <span class="pre">proto_encode</span> <span class="pre">--input</span> <span class="pre">config.json</span> <span class="pre">--type</span> <span class="pre">common.Config</span> <span class="pre">--output</span> <span class="pre">config.pb</span>
<span class="pre">configtxlator</span> <span class="pre">proto_encode</span> <span class="pre">--input</span> <span class="pre">modified_config.json</span> <span class="pre">--type</span> <span class="pre">common.Config</span> <span class="pre">--output</span> <span class="pre">modified_config.pb</span>
<span class="pre">configtxlator</span> <span class="pre">compute_update</span> <span class="pre">--channel_id</span> <span class="pre">channel1</span> <span class="pre">--original</span> <span class="pre">config.pb</span> <span class="pre">--updated</span> <span class="pre">modified_config.pb</span> <span class="pre">--output</span> <span class="pre">config_update.pb</span>
<span class="pre">`</span></code></p>
<p>将配置更新包装在交易Envelope中以创建通道配置更新交易：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">configtxlator</span> <span class="pre">proto_decode</span> <span class="pre">--input</span> <span class="pre">config_update.pb</span> <span class="pre">--type</span> <span class="pre">common.ConfigUpdate</span> <span class="pre">--output</span> <span class="pre">config_update.json</span>
<span class="pre">echo</span> <span class="pre">'{&quot;payload&quot;:{&quot;header&quot;:{&quot;channel_header&quot;:{&quot;channel_id&quot;:&quot;channel1&quot;,</span> <span class="pre">&quot;type&quot;:2}},&quot;data&quot;:{&quot;config_update&quot;:'$(cat</span> <span class="pre">config_update.json)'}}}'</span> <span class="pre">|</span> <span class="pre">jq</span> <span class="pre">.</span> <span class="pre">&gt;</span> <span class="pre">config_update_in_envelope.json</span>
<span class="pre">configtxlator</span> <span class="pre">proto_encode</span> <span class="pre">--input</span> <span class="pre">config_update_in_envelope.json</span> <span class="pre">--type</span> <span class="pre">common.Envelope</span> <span class="pre">--output</span> <span class="pre">config_update_in_envelope.pb</span>
<span class="pre">`</span></code></p>
<p>回到`test-network`目录.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">cd</span> <span class="pre">..</span>
<span class="pre">`</span></code></p>
<p>通过执行以下命令来更新通道并设置Org2的Peer锚节点：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">update</span> <span class="pre">-f</span> <span class="pre">channel-artifacts/config_update_in_envelope.pb</span> <span class="pre">-c</span> <span class="pre">channel1</span> <span class="pre">-o</span> <span class="pre">localhost:7050</span>&#160; <span class="pre">--ordererTLSHostnameOverride</span> <span class="pre">orderer.example.com</span> <span class="pre">--tls</span> <span class="pre">--cafile</span> <span class="pre">${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span>
<span class="pre">`</span></code></p>
<p>您可以通过运行`peer channel info`命令来确认通道已成功更新：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">peer</span> <span class="pre">channel</span> <span class="pre">getinfo</span> <span class="pre">-c</span> <span class="pre">channel1</span>
<span class="pre">`</span></code></p>
<p>现在，已经通过在通道创世块中添加两个通道配置块来更新通道，通道的高度将增加到3：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">Blockchain</span> <span class="pre">info:</span> <span class="pre">{&quot;height&quot;:3,&quot;currentBlockHash&quot;:&quot;eBpwWKTNUgnXGpaY2ojF4xeP3bWdjlPHuxiPCTIMxTk=&quot;,&quot;previousBlockHash&quot;:&quot;DpJ8Yvkg79XHXNfdgneDb0jjQlXLb/wxuNypbfHMjas=&quot;}</span>
<span class="pre">`</span></code></p>
<p>## 在新通道上部署链码</p>
<p>通过将链码部署到通道，我们可以确认该通道已成功创建。我们可以使用`network.sh`脚本将Fabcar链码部署到任何测试网络通道。使用以下命令将链码部署到我们的新通道：</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">./network.sh</span> <span class="pre">deployCC</span> <span class="pre">-c</span> <span class="pre">channel1</span>
<span class="pre">`</span></code></p>
<p>运行命令后，您应该在日志中看到链代码已部署到通道。调用链码将数据添加到通道账本中，然后查询。</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">[{&quot;Key&quot;:&quot;CAR0&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Toyota&quot;,&quot;model&quot;:&quot;Prius&quot;,&quot;colour&quot;:&quot;blue&quot;,&quot;owner&quot;:&quot;Tomoko&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR1&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Ford&quot;,&quot;model&quot;:&quot;Mustang&quot;,&quot;colour&quot;:&quot;red&quot;,&quot;owner&quot;:&quot;Brad&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR2&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Hyundai&quot;,&quot;model&quot;:&quot;Tucson&quot;,&quot;colour&quot;:&quot;green&quot;,&quot;owner&quot;:&quot;Jin</span> <span class="pre">Soo&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR3&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Volkswagen&quot;,&quot;model&quot;:&quot;Passat&quot;,&quot;colour&quot;:&quot;yellow&quot;,&quot;owner&quot;:&quot;Max&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR4&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Tesla&quot;,&quot;model&quot;:&quot;S&quot;,&quot;colour&quot;:&quot;black&quot;,&quot;owner&quot;:&quot;Adriana&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR5&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Peugeot&quot;,&quot;model&quot;:&quot;205&quot;,&quot;colour&quot;:&quot;purple&quot;,&quot;owner&quot;:&quot;Michel&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR6&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Chery&quot;,&quot;model&quot;:&quot;S22L&quot;,&quot;colour&quot;:&quot;white&quot;,&quot;owner&quot;:&quot;Aarav&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR7&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Fiat&quot;,&quot;model&quot;:&quot;Punto&quot;,&quot;colour&quot;:&quot;violet&quot;,&quot;owner&quot;:&quot;Pari&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR8&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Tata&quot;,&quot;model&quot;:&quot;Nano&quot;,&quot;colour&quot;:&quot;indigo&quot;,&quot;owner&quot;:&quot;Valeria&quot;}},</span>
<span class="pre">{&quot;Key&quot;:&quot;CAR9&quot;,&quot;Record&quot;:{&quot;make&quot;:&quot;Holden&quot;,&quot;model&quot;:&quot;Barina&quot;,&quot;colour&quot;:&quot;brown&quot;,&quot;owner&quot;:&quot;Shotaro&quot;}}]</span>
<span class="pre">=====================</span> <span class="pre">Query</span> <span class="pre">successful</span> <span class="pre">on</span> <span class="pre">peer0.org1</span> <span class="pre">on</span> <span class="pre">channel</span> <span class="pre">'channel1'</span> <span class="pre">=====================</span>
<span class="pre">`</span></code></p>
<p>&lt;!— Licensed under Creative Commons Attribution 4.0 International License
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a> –&gt;</p>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="create_channel_config.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_channel_overview.html" class="btn btn-neutral" title="创建通道" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>